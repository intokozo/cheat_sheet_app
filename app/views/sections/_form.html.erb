<%= form_with model: section do |form| %>
  <% if section.errors.any? %>
    <div class="alert alert-danger">
      <h4>Обнаружены ошибки:</h4>
      <ul>
        <% section.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= form.label :parent_id, "Родительский раздел", class: "form-label" %>
    <%= form.collection_select :parent_id, 
                              Section.where.not(id: section.id || 0), 
                              :id, :full_path, 
                              { include_blank: "Нет (корневой раздел)" }, 
                              class: "form-control" %>
  </div>

  <div class="mb-3">
    <%= form.label :title, "Название раздела", class: "form-label" %>
    <%= form.text_field :title, class: "form-control", required: true %>
    <div class="form-text">Обязательное поле</div>
  </div>

  <div class="mb-3">
    <%= form.label :description, "Описание", class: "form-label" %>
    <%= form.text_area :description, class: "form-control", rows: 3 %>
  </div>

  <div class="mb-3">
    <%= form.submit "Сохранить", class: "btn btn-primary" %>
    <%= link_to "Отмена", (section.persisted? ? (section.parent ? section_path(section.parent) : sections_path) : sections_path), class: "btn btn-secondary" %>
  </div>
<% end %>