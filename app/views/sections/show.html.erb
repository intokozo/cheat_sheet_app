<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><%= link_to "Главная", root_path %></li>
    <% if @section.parent %>
      <li class="breadcrumb-item"><%= link_to @section.parent.title, @section.parent %></li>
    <% end %>
    <li class="breadcrumb-item active"><%= @section.title %></li>
  </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1><%= @section.title %></h1>
    <% if @section.description.present? %>
      <p class="text-muted"><%= @section.description %></p>
    <% end %>
    <small class="text-muted">Полный путь: <%= @section.full_path %></small>
  </div>
  <div>
    <%= link_to "Добавить подраздел", new_section_child_path(@section), class: "btn btn-success" %>
    <%= link_to "Добавить статью", new_section_article_path(@section), class: "btn btn-primary" %>
    <%= link_to "Редактировать", edit_section_path(@section), class: "btn btn-outline-secondary" %>
    <%= link_to "Назад", (@section.parent ? section_path(@section.parent) : sections_path), class: "btn btn-outline-primary" %>
  </div>
</div>

<% if @children.any? %>
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">Подразделы</h5>
    </div>
    <div class="list-group list-group-flush">
      <% @children.each do |child| %>
        <%= render 'section_item', section: child %>
      <% end %>
    </div>
  </div>
<% end %>

<% if @articles.any? %>
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">Статьи в этом разделе</h5>
    </div>
    <div class="list-group list-group-flush">
      <% @articles.each do |article| %>
        <div class="list-group-item">
          <div class="d-flex w-100 justify-content-between">
            <h6 class="mb-1">
              <%= link_to article.title, [@section, article] %>
            </h6>
            <small><%= article.created_at.strftime("%d.%m.%Y") %></small>
          </div>
          <% if article.content.to_plain_text.present? %>
            <p class="mb-1 text-muted small">
              <%= truncate(article.content.to_plain_text, length: 150) %>
            </p>
          <% end %>
          <div class="mt-2">
            <%= link_to "Редактировать", edit_section_article_path(@section, article), class: "btn btn-sm btn-outline-secondary" %>
            <%= link_to "Удалить", [@section, article], method: :delete, 
                        data: { confirm: "Удалить статью?" }, 
                        class: "btn btn-sm btn-outline-danger" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% else %>
  <% if @children.empty? %>
    <div class="text-center py-5">
      <h4>В этом разделе пока нет статей или подразделов</h4>
      <p class="text-muted">Создайте первую статью или подраздел</p>
      <div>
        <%= link_to "Создать подраздел", new_section_child_path(@section), class: "btn btn-success" %>
        <%= link_to "Создать статью", new_section_article_path(@section), class: "btn btn-primary" %>
      </div>
    </div>
  <% end %>
<% end %>